<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>tutorial.md</title><link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css'><style type='text/css'>html, body {overflow-x: initial !important;}.CodeMirror { height: auto; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; }
.CodeMirror-lines { padding: 4px 0px; }
.CodeMirror pre { }
.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { background-color: white; }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); white-space: nowrap; background-color: rgb(247, 247, 247); }
.CodeMirror-linenumbers { }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.CodeMirror div.CodeMirror-cursor { border-left-width: 1px; border-left-style: solid; border-left-color: black; z-index: 3; }
.CodeMirror div.CodeMirror-secondarycursor { border-left-width: 1px; border-left-style: solid; border-left-color: silver; }
.CodeMirror.cm-keymap-fat-cursor div.CodeMirror-cursor { width: auto; border: 0px; z-index: 1; background: rgb(119, 238, 119); }
.CodeMirror div.CodeMirror-cursor.CodeMirror-overwrite { }
.cm-tab { display: inline-block; }
.cm-s-typora-default .cm-header, .cm-s-typora-default .cm-property { color: rgb(217, 79, 138); }
.cm-s-typora-default pre.cm-header1:not(.cm-atom) :not(.cm-overlay) { font-size: 2rem; line-height: 2rem; }
.cm-s-typora-default pre.cm-header2:not(.cm-atom) :not(.cm-overlay) { font-size: 1.4rem; line-height: 1.4rem; }
.cm-s-typora-default .cm-atom, .cm-s-typora-default .cm-number { color: rgb(149, 132, 134); }
.cm-s-typora-default .cm-table-row, .cm-s-typora-default .cm-block-start { font-family: monospace; }
.cm-s-typora-default .cm-comment, .cm-s-typora-default .cm-code { color: rgb(74, 90, 159); font-family: monospace; }
.cm-s-typora-default .cm-tag { color: rgb(169, 68, 66); }
.cm-s-typora-default .cm-string { color: rgb(126, 134, 169); }
.cm-s-typora-default .cm-link { color: rgb(196, 122, 15); text-decoration: underline; }
.cm-s-typora-default .cm-variable-2, .cm-s-typora-default .cm-variable-1 { color: inherit; }
.cm-s-typora-default .cm-overlay { font-size: 1rem; font-family: monospace; }
.CodeMirror.cm-s-typora-default div.CodeMirror-cursor { border-left-width: 3px; border-left-style: solid; border-left-color: rgb(228, 98, 154); }
.cm-s-typora-default .CodeMirror-activeline-background { left: -60px; right: -30px; background: rgba(204, 204, 204, 0.2); }
.cm-s-typora-default .CodeMirror-gutters { border-right-style: none; background-color: inherit; }
.cm-s-typora-default .cm-trailing-space-new-line::after, .cm-startspace::after, .cm-starttab .cm-tab::after { content: "•"; position: absolute; left: 0px; opacity: 0; font-family: LetterGothicStd, monospace; }
.os-windows .cm-startspace::after, .os-windows .cm-starttab .cm-tab::after { left: -0.1em; }
.cm-starttab .cm-tab::after { content: " "; }
.cm-startspace, .cm-tab, .cm-starttab, .cm-trailing-space-a, .cm-trailing-space-b, .cm-trailing-space-new-line { font-family: monospace; position: relative; }
.cm-s-typora-default .cm-trailing-space-new-line::after { content: "↓"; opacity: 0.3; }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: black; }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-property { color: black; }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: blue; }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: bold; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: rgb(255, 0, 0); }
.cm-invalidchar { color: rgb(255, 0, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 100%; outline: none; position: relative; box-sizing: content-box; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow-x: hidden; overflow-y: scroll; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow-y: hidden; overflow-x: scroll; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background: transparent; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-widget { }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.CodeMirror-selected { background: rgb(217, 217, 217); }
.CodeMirror-focused .CodeMirror-selected { background: rgb(215, 212, 240); }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
.CodeMirror span { }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}
.CodeMirror-lint-markers { width: 16px; }
.CodeMirror-lint-tooltip { border: 1px solid black; border-radius: 4px; color: infotext; font-family: monospace; overflow: hidden; padding: 2px 5px; position: fixed; white-space: pre-wrap; z-index: 10000; max-width: 600px; opacity: 0; transition: opacity 0.4s; font-size: 0.8em; background-color: infobackground; }
.CodeMirror-lint-mark-error, .CodeMirror-lint-mark-warning { background-position: left bottom; background-repeat: repeat-x; }
.CodeMirror-lint-mark-error { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAYAAAC09K7GAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sJDw4cOCW1/KIAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAHElEQVQI12NggIL/DAz/GdA5/xkY/qPKMDAwAADLZwf5rvm+LQAAAABJRU5ErkJggg=="); }
.CodeMirror-lint-marker-error, .CodeMirror-lint-marker-warning { cursor: pointer; display: inline-block; height: 16px; width: 16px; vertical-align: middle; position: relative; background-position: center center; background-repeat: no-repeat; }
.CodeMirror-lint-message-error, .CodeMirror-lint-message-warning { padding-left: 18px; background-position: left top; background-repeat: no-repeat; }
.CodeMirror-lint-marker-error, .CodeMirror-lint-message-error { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAHlBMVEW7AAC7AACxAAC7AAC7AAAAAAC4AAC5AAD///+7AAAUdclpAAAABnRSTlMXnORSiwCK0ZKSAAAATUlEQVR42mWPOQ7AQAgDuQLx/z8csYRmPRIFIwRGnosRrpamvkKi0FTIiMASR3hhKW+hAN6/tIWhu9PDWiTGNEkTtIOucA5Oyr9ckPgAWm0GPBog6v4AAAAASUVORK5CYII="); }
.CodeMirror-lint-marker-warning, .CodeMirror-lint-message-warning { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAANlBMVEX/uwDvrwD/uwD/uwD/uwD/uwD/uwD/uwD/uwD6twD/uwAAAADurwD2tQD7uAD+ugAAAAD/uwDhmeTRAAAADHRSTlMJ8mN1EYcbmiixgACm7WbuAAAAVklEQVR42n3PUQqAIBBFUU1LLc3u/jdbOJoW1P08DA9Gba8+YWJ6gNJoNYIBzAA2chBth5kLmG9YUoG0NHAUwFXwO9LuBQL1giCQb8gC9Oro2vp5rncCIY8L8uEx5ZkAAAAASUVORK5CYII="); }
.CodeMirror-lint-marker-multiple { width: 100%; height: 100%; background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAMAAADzjKfhAAAACVBMVEUAAAAAAAC/v7914kyHAAAAAXRSTlMAQObYZgAAACNJREFUeNo1ioEJAAAIwmz/H90iFFSGJgFMe3gaLZ0od+9/AQZ0ADosbYraAAAAAElFTkSuQmCC"); background-position: right bottom; background-repeat: no-repeat; }


html { font-size: 14px; color: rgb(51, 51, 51); background-color: rgb(255, 255, 255); }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: rgb(181, 214, 252); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; padding-bottom: 70px; white-space: pre-wrap; overflow-x: auto; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
@media screen and (max-width: 500px) { 
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
.typora-export #write { margin: 0px auto; }
#write > p:first-child, #write > ul:first-child, #write > ol:first-child, #write > pre:first-child, #write > blockquote:first-child, #write > div:first-child, #write > table:first-child { margin-top: 30px; }
#write li > table:first-child { margin-top: -20px; }
img { max-width: 100%; }
input, button, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
::before, ::after, * { box-sizing: border-box; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write div, #write pre { width: inherit; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6 { position: relative; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
p { -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; }
.mathjax-block { margin-top: 0px; margin-bottom: 0px; -webkit-margin-before: 0rem; -webkit-margin-after: 0rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: bold; font-style: italic; }
a { cursor: pointer; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; margin: 4px 0px 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 80px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
pre { white-space: pre-wrap; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; position: relative !important; background: inherit; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
.md-fences .CodeMirror.CodeMirror-wrap { top: -1.6em; margin-bottom: -1.6em; }
.md-fences.mock-cm { white-space: pre-wrap; }
.show-fences-line-number .md-fences { padding-left: 0px; }
.show-fences-line-number .md-fences.mock-cm { padding-left: 40px; }
.footnotes { opacity: 0.8; font-size: 0.9rem; padding-top: 1em; padding-bottom: 1em; }
.footnotes + .footnotes { margin-top: -1em; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: normal; text-align: left; box-sizing: content-box; direction: ltr; background: transparent; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li p, li .mathjax-block { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; }
@media print { 
  html, body { height: 100%; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  h1, h2, h3, h4, h5, h6 { break-after: avoid-page; orphans: 2; }
  p { orphans: 4; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 1cm; padding-right: 1cm; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0mm; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 2.86rem; white-space: pre-wrap; display: block; background: rgb(204, 204, 204); }
p .md-image:only-child, p img:only-child { display: inline-block; width: 100%; text-align: center; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.mathjax-block { white-space: pre; overflow: hidden; width: 100%; }
p + .mathjax-block { margin-top: -1.143rem; }
.mathjax-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: none; box-shadow: none; }
.task-list { list-style-type: none; }
.task-list-item { position: relative; padding-left: 1em; }
.task-list-item input { position: absolute; top: 0px; left: 0px; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc::after, .md-toc-content::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); text-decoration: none; }
.md-toc-inner:hover { }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: bold; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
.md-tag { opacity: 0.5; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: monospace; }
code { text-align: left; }
h1 .md-tag, h2 .md-tag, h3 .md-tag, h4 .md-tag, h5 .md-tag, h6 .md-tag { font-weight: initial; opacity: 0.35; }
a.md-header-anchor.md-print-anchor { border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: none !important; text-decoration: initial !important; text-shadow: initial !important; background: transparent !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.mathjax-block .MathJax_SVG_Display { text-align: center; margin: 1em 0em; position: relative; text-indent: 0px; max-width: none; max-height: none; min-width: 0px; min-height: 0px; width: 100%; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: monospace; }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: normal; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }


@font-face { font-family: "Open Sans"; font-style: normal; font-weight: normal; src: local("Open Sans Regular"), url("./github/400.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: italic; font-weight: normal; src: local("Open Sans Italic"), url("./github/400i.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: normal; font-weight: bold; src: local("Open Sans Bold"), url("./github/700.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: italic; font-weight: bold; src: local("Open Sans Bold Italic"), url("./github/700i.woff") format("woff"); }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 20px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
body > :first-child { margin-top: 0px !important; }
body > :last-child { margin-bottom: 0px !important; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 4px; padding: 0px; margin: 16px 0px; border-width: 0px 0px 1px; border-style: none none solid; overflow: hidden; box-sizing: content-box; border-bottom-color: rgb(221, 221, 221); background-color: rgb(231, 231, 231); }
body > h2:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child + h2 { margin-top: 0px; padding-top: 0px; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child { margin-top: 0px; padding-top: 0px; }
a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 { margin-top: 0px; padding-top: 0px; }
h1 p, h2 p, h3 p, h4 p, h5 p, h6 p { margin-top: 0px; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left-width: 4px; border-left-style: solid; border-left-color: rgb(221, 221, 221); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
#write { overflow-x: auto; }
table tr { border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); margin: 0px; padding: 0px; background-color: white; }
table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); }
.md-fences, code, tt { border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; background-color: rgb(248, 248, 248); }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding: 8px 1em 6px; }
.task-list { padding-left: 0px; }
.task-list-item { padding-left: 32px; }
.task-list-item input { top: 3px; left: 8px; }
@media screen and (min-width: 914px) { 
}
@media print { 
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; background-color: rgb(247, 247, 247); }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; color: inherit; background-color: rgb(248, 248, 248); }
.md-tag { color: inherit; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; background-color: rgb(250, 250, 250); }
#md-notification::before { top: 10px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.117647); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }






</style>
</head>
<body class='typora-export' >
<div  id='write'  class = 'is-node'><p><strong>Sand</strong> is a fun physics based drawing game that you can play on your browser, you can use different colors to draw as well as change the nature of your drawn pixels to simulate the behavior of gravity on water, rock and air.</p><p></p><p>As with writing any type of game, you always need to have the following features:</p><ul><li>User interface</li><li>Data structures.</li><li>Game engine which handles: graphics and user input</li><li>The main game loop</li><li>Physics effects</li></ul><h2><a name='header-c28' class='md-header-anchor '></a><strong>Project Structure</strong></h2><p>Our project is quite simple, so we’ll go ahead and create 3 new files:</p><p style="text-align: center;"> <img src='files.png' alt='files' style="width: auto;"/></p><ul><li><strong>logic.js</strong> : This file will contain all of our JavaScript logic and game implementation</li><li><strong>main.html</strong> : We will put our game UI here, for now all we need is a &quot;screen&quot; and instructions, so this should be simple to setup.</li><li><strong>style.css</strong> : Some styling for our UI.</li></ul><p>You can initialize a <strong>git</strong> repository if you want to keep track of your changes, but since this is a one day project, we&#39;ll go ahead without it.</p><p></p><h2><a name='header-c47' class='md-header-anchor '></a>User Interface</h2><p>Any game needs a proper User Interface, otherwise it would be unplayable, in our cases we don&#39;t need to create something fancy, so let&#39;s get started.</p><p></p><p>We&#39;ll go ahead and create our <strong>main.html</strong> file:</p><p></p><pre class="md-fences md-end-block" lang="html"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">&lt;!DOCTYPE html&gt;</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">html</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">head</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">title</span><span class="cm-tag cm-bracket">&gt;</span>Sand Game<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">title</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">link</span> <span class="cm-attribute">rel</span>=<span class="cm-string">"stylesheet"</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text/css"</span> <span class="cm-attribute">href</span>=<span class="cm-string">"style.css"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">head</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">body</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">canvas</span> <span class="cm-attribute">id</span>=<span class="cm-string">"screen"</span> <span class="cm-attribute">width</span>=<span class="cm-string">"960"</span> <span class="cm-attribute">height</span>=<span class="cm-string">"640"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">canvas</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">section</span> <span class="cm-attribute">id</span>=<span class="cm-string">"guide"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">section</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text/javascript"</span> <span class="cm-attribute">src</span>=<span class="cm-string">"logic.js"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">body</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">html</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 368px;"></div></div></div></pre><p></p><p>As you can see, it&#39;s quite straight forward, we have our <strong>canvas</strong> element where the game will be rendered (We&#39;ll talk about more this later in this tutorial), a <strong>guide</strong> section to explain how the game can be played and finally we include our logic JavaScript.</p><p></p><p>We&#39;ll go ahead and set the guide code block as follows:</p><pre class="md-fences md-end-block" lang="html"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">section</span> <span class="cm-attribute">id</span>=<span class="cm-string">"guide"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span>Use your mouse to draw.<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span>To change drawing color/type, you can press:<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span>To clear the screen press <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">b</span><span class="cm-tag cm-bracket">&gt;</span>Escape<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">b</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">br</span><span class="cm-tag cm-bracket">/&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">ul</span> <span class="cm-attribute">class</span>=<span class="cm-string">"keyboard"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>A<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Air<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>W<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Water<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>S<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Static<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>L<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Land<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">ul</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">ul</span> <span class="cm-attribute">class</span>=<span class="cm-string">"keyboard"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Orange<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>2<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Light blue<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>3<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Yellow<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>4<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Light Green<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">ul</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">ul</span> <span class="cm-attribute">class</span>=<span class="cm-string">"keyboard"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>5<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Pink<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>6<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Gray<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>7<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Purple<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>8<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Blue<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">ul</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">ul</span> <span class="cm-attribute">class</span>=<span class="cm-string">"keyboard"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>9<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Magenta<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>0<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Black<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>-<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Brown<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>=<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> Red<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">li</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">ul</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">br</span> <span class="cm-attribute">class</span>=<span class="cm-string">"clear"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">section</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 897px;"></div></div></div></pre><p>This will display a list of keyboard keys that the player can use to change the type of pixels he&#39;s drawing. The player can also press <strong>Escape</strong> to clear the entire screen.</p><p></p><p>We can now style our UI to make nice and clean, you can go ahead and add the following code to the <strong>style.css</strong> file:</p><pre class="md-fences md-end-block" lang="css"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;">* {</span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">margin</span>: <span class="cm-number">0px</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">html</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">font-family</span>: <span class="cm-variable">Tahoma</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">p</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">text-align</span>: <span class="cm-atom">center</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">margin-bottom</span>: <span class="cm-number">10px</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-qualifier">.clear</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">clear</span>: <span class="cm-atom">both</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">#screen</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">margin</span>: <span class="cm-number">20px</span> <span class="cm-atom">auto</span> <span class="cm-number">0px</span> <span class="cm-atom">auto</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">display</span>: <span class="cm-atom">block</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">border</span>: <span class="cm-number">4px</span> <span class="cm-atom">solid</span> <span class="cm-atom">#898989</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">#screen</span>:<span class="cm-variable-3">hover</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">cursor</span>: <span class="cm-atom">crosshair</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-builtin">#guide</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">width</span>: <span class="cm-number">960px</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">padding-top</span>: <span class="cm-number">30px</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">margin</span>: <span class="cm-number">0px</span> <span class="cm-atom">auto</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-qualifier">.keyboard</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">float</span>: <span class="cm-atom">left</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">width</span>: <span class="cm-number">25%</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">margin</span>: <span class="cm-number">0px</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">box-sizing</span>: <span class="cm-atom">border-box</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">list-style</span>: <span class="cm-atom">none</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">padding-bottom</span>: <span class="cm-number">20px</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-qualifier">.keyboard</span> <span class="cm-tag">li</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">margin-bottom</span>: <span class="cm-number">10px</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-qualifier">.keyboard</span> <span class="cm-tag">li</span> <span class="cm-tag">span</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">display</span>: <span class="cm-atom">inline-block</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">padding</span>: <span class="cm-number">6px</span> <span class="cm-number">0px</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">width</span>: <span class="cm-number">36px</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">text-align</span>: <span class="cm-atom">center</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">border-radius</span>: <span class="cm-number">4px</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">background-color</span>: <span class="cm-atom">#e5e5e5</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">font-weight</span>: <span class="cm-atom">bold</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-property">margin-right</span>: <span class="cm-number">10px</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1288px;"></div></div></div></pre><p></p><p>You can now open the main.html file in your browser, and if you did everything correctly, you should see the following result:</p><p></p><p><img src='ui-1.png' alt='ui-1' /></p><p></p><p> We have a UI now! all we have to do now is bring to it life.</p><p></p><h2><a name='header-c87' class='md-header-anchor '></a>Data structures.</h2><p>Since this is a drawing game, our only game object is the screen itself. So to keep things simple we&#39;ll be modeling our screen in the form of a 2 dimensional array, in the spirit of keeping things simple.</p><p></p><h2><a name='header-c92' class='md-header-anchor '></a>Game Engine</h2><p>Since we&#39;re building a web game, we will be using <strong>JavaScript</strong> to write our game logic, I chose to encapsulate the entire engine into one big class called <strong>Sand</strong>, let&#39;s go ahead and add it to our <strong>logic.js</strong> file:</p><p></p><pre class="md-fences md-end-block" lang="javascript"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * Implements a physics based drawing game.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @class</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @namespace</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @this {Sand}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-def">Sand</span>() {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* Class initialization code goes here. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 207px;"></div></div></div></pre><p></p><p>Don&#39;t be alarmed, that is indeed a function and not a class, but in JavaScript there is a nifty feature callled <strong>Prototypal Inheritance</strong>, which allows you to implement <strong>class</strong> models similar to how you would do it in <strong>Object Oriented Programming</strong>, but it is not quite the same thing, you can learn more about this here: <a href='http://javascript.crockford.com/prototypal.html' target='_blank' >http://javascript.crockford.com/prototypal.html</a></p><p></p><h3><a name='header-c104' class='md-header-anchor '></a><strong>Graphics</strong></h3><p>One of the best ways to program games on the web is by using the HTML5 <strong>Canvas API</strong>, which is basically a drawing board with a great set of tools that we can use to paint anything we like, from rectangles and circles to paths and images. You can learn more about it here: <a href='https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API' target='_blank' >https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API</a></p><p>Using <strong>Canvas</strong> will greatly simplify our task, as we can rely on ready to use functions and methods to draw stuff.</p><p></p><p>We&#39;ll go ahead and add some <strong>Canvas</strong> related properties to our class:</p><p></p><pre class="md-fences md-end-block" lang="javascript"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * Implements a physics based drawing game.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @class</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @namespace</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @this {Sand}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-def">Sand</span>() {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/**</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * The first property is screenCanvas which is just a reference to the DOM canvas element we </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * added to our html document earlier, we'll be using this to get our 2d drawing context as </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * well as some attributes such as the width and height which will be used later.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">getElementById</span>( <span class="cm-string">"screen"</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/**</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * The second property, canvasContext, is the  canvas context object, which contains all of </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * the powerful canvas APIs that you can use to interact with it. We'll use this mainly to </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * draw our pixels in our screen.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">canvasContext</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span>.<span class="cm-property">getContext</span>( <span class="cm-string">"2d"</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/**</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * The third property, tileSize, is the size of each "pixel" in our game screen, it's </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * basically the number of actual pixels our rectangular tile will occupy in the canvas box. </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * Starting from now we'll refer to the drawn pixels as tiles, so that we can differentiate </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * between the big game pixels and the actual browser/display pixels. This argument will be </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * used to do some calculations as well as draw our tiles.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/**</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * The following 2 properties are the number of tiles in each direction of our screen, we </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * divide the actual dimensions of our canvas - that we set as element attributes in our </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * html file - by the tile size, which gives us how many tiles we will be able to fit in our </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * screen.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">horizontalTileCount</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span>.<span class="cm-property">width</span> <span class="cm-operator">/</span> <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">verticalTileCount</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span>.<span class="cm-property">height</span> <span class="cm-operator">/</span> <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-tab">  </span><span class="cm-comment">/* This is our screen, as explained earlier, this will be a 2 dimensional array. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">tiles</span> <span class="cm-operator">=</span> [];</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/* We instantiate our class with thew new keyword. See just like OO programming! */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">game</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Sand</span>();</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1035px;"></div></div></div></pre><p></p><p>You can go ahead and refresh your page now, if you did everything correctly, then you should see no difference compared to the previous phase, however keep an eye on your browser developer console, in case there are some errors.</p><p></p><p>Next we&#39;ll add some constants that we will be using in our physics and graphics logic, you can go ahead and add the following code to the top of your <strong>logic.js</strong> file, right before the <strong>Sand</strong> class:</p><p></p><pre class="md-fences md-end-block" lang="javascript"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/* Tile types and colors. */</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">TILE_AIR</span> <span class="cm-operator">=</span> <span class="cm-string">"a"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-def">TILE_LAND</span>  <span class="cm-operator">=</span> <span class="cm-string">"l"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-def">TILE_WATER</span>  <span class="cm-operator">=</span> <span class="cm-string">"w"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-def">TILE_STATIC</span> <span class="cm-operator">=</span> <span class="cm-string">"s"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* This array will be used in screen intialization */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-def">TILE_TYPES</span> <span class="cm-operator">=</span> [ <span class="cm-variable">TILE_AIR</span>, <span class="cm-variable">TILE_LAND</span>, <span class="cm-variable">TILE_WATER</span>, <span class="cm-variable">TILE_STATIC</span> ],</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* This object will be used to decide which color to use when we're drawing each tile. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-def">TILE_COLORS</span> <span class="cm-operator">=</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"a"</span>: <span class="cm-string">"#ffffff"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"l"</span>: <span class="cm-string">"#2affa2"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"w"</span>: <span class="cm-string">"#add8e6"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"s"</span>: <span class="cm-string">"#000000"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"0"</span>: <span class="cm-string">"#000000"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"1"</span>: <span class="cm-string">"#f7941d"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"2"</span>: <span class="cm-string">"#00ffff"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"3"</span>: <span class="cm-string">"#fff200"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"4"</span>: <span class="cm-string">"#00ff00"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"5"</span>: <span class="cm-string">"#ec008c"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"6"</span>: <span class="cm-string">"#959595"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"7"</span>: <span class="cm-string">"#92278f"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"8"</span>: <span class="cm-string">"#0000ff"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"9"</span>: <span class="cm-string">"#ff00ff"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"-"</span>: <span class="cm-string">"#754c24"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string cm-property">"="</span>: <span class="cm-string">"#ed1c24"</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  };</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 598px;"></div></div></div></pre><p></p><p>As you can see, we have 4 tile natures: air, land, water, and static tiles which can have multiple colors.</p><p>Static tiles can either have the value <strong>s</strong> or the other color values. All of them are considered static tiles, they are basically tiles that don&#39;t move when drawn and they don&#39;t have any kind of physics effect.</p><p></p><h3><a name='header-c135' class='md-header-anchor '></a><strong>Initialization</strong></h3><p>We&#39;ll go ahead and add a new method to our <strong>Sand</strong> class, called <strong>initialize</strong>, this method will initialize our screen data structure to randomized values, just for the fun of it. You can add this code right after your <strong>Sand</strong> class:</p><p></p><pre class="md-fences md-end-block" lang="javascript"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * Initializes the screen with randomized tiles.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @name initialize</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @function</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @memberof Sand</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @returns {void}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Sand</span>.<span class="cm-property">prototype</span>.<span class="cm-property">initialize</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-def">L</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">horizontalTileCount</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-def">j</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-def">M</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">verticalTileCount</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-def">column</span> <span class="cm-operator">=</span> [];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">for</span>( ; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">L</span>; <span class="cm-operator">++</span><span class="cm-variable-2">i</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">for</span>( <span class="cm-variable-2">j</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">j</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">M</span>; <span class="cm-operator">++</span><span class="cm-variable-2">j</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">/* As you can see here, we used TILE_TYPES to get random tile natures. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">column</span>.<span class="cm-property">push</span>( <span class="cm-variable">TILE_TYPES</span>[ <span class="cm-variable">Math</span>.<span class="cm-property">floor</span>( <span class="cm-variable">Math</span>.<span class="cm-property">random</span>() <span class="cm-operator">*</span> <span class="cm-number">4</span> ) ] );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">tiles</span>.<span class="cm-property">push</span>( <span class="cm-variable-2">column</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">column</span> <span class="cm-operator">=</span> [];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 483px;"></div></div></div></pre><p></p><p>We&#39;ll go ahead and call this method in our main class constructor:</p><p></p><pre class="md-fences md-end-block" lang="javascript"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-def">Sand</span>() {</span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">getElementById</span>( <span class="cm-string">"screen"</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">canvasContext</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span>.<span class="cm-property">getContext</span>( <span class="cm-string">"2d"</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">horizontalTileCount</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span>.<span class="cm-property">width</span> <span class="cm-operator">/</span> <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">verticalTileCount</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span>.<span class="cm-property">height</span> <span class="cm-operator">/</span> <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">tiles</span> <span class="cm-operator">=</span> [];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; <span class="cm-keyword">this</span>.<span class="cm-property">initialize</span>(); <span class="cm-comment">/* New code! */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 299px;"></div></div></div></pre><p></p><p><strong>Note:</strong> If you&#39;re copy pasting the code, make sure to remove the <strong>+</strong> in front of each line, I am including those so that you can tell which new lines of code have been added. I highly advise you to type the code yourself, so that you can get used to it.</p><p></p><p>Now that we have our screen, we can go ahead and write some code to render it to our <strong>Canvas</strong>! To do that, we&#39;ll add a new method:</p><pre class="md-fences md-end-block" lang="javascript"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * Redraws the a set of tiles</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * This is an optimization to avoid redrawing the entire screen</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * Instead we only draw the tile that have changes.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @name drawScreen</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @function</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @memberof Sand</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param {Array} tilesToRedraw A list of tiles (x, y and new value ) to redraw.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @returns {void}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Sand</span>.<span class="cm-property">prototype</span>.<span class="cm-property">drawScreen</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>( <span class="cm-def">tilesToRedraw</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-def">L</span> <span class="cm-operator">=</span> <span class="cm-variable-2">tilesToRedraw</span>.<span class="cm-property">length</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-def">tiles</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">tiles</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">for</span>( ; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">L</span>; <span class="cm-operator">++</span><span class="cm-variable-2">i</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">tile</span> <span class="cm-operator">=</span> <span class="cm-variable-2">tilesToRedraw</span>[ <span class="cm-variable-2">i</span> ];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">tiles</span>[ <span class="cm-variable-2">tile</span>.<span class="cm-property">x</span> ][ <span class="cm-variable-2">tile</span>.<span class="cm-property">y</span> ] <span class="cm-operator">=</span> <span class="cm-variable-2">tile</span>.<span class="cm-property">value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-tab">  </span><span class="cm-comment">/* These are the only Canvas APIs we'll be using this game */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">/* This one changes the filling color that canvas will be using to draw. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">canvasContext</span>.<span class="cm-property">fillStyle</span> <span class="cm-operator">=</span> <span class="cm-variable">TILE_COLORS</span>[ <span class="cm-variable-2">tile</span>.<span class="cm-property">value</span> ];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-tab">  </span><span class="cm-comment">/**</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp;  <span class="cm-tab">  </span> * This one tells canvas to draw a rectangle at the specified coordinates and with the </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp;  <span class="cm-tab">  </span> * specified dimensions: x, y, width and height.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp;  <span class="cm-tab">  </span> */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">canvasContext</span>.<span class="cm-property">fillRect</span>( <span class="cm-variable-2">tile</span>.<span class="cm-property">x</span> <span class="cm-operator">*</span> <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span>, <span class="cm-variable-2">tile</span>.<span class="cm-property">y</span> <span class="cm-operator">*</span> <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span>, <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span>, <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span> ); </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 713px;"></div></div></div></pre><p></p><p>As you&#39;ve probably noticed, we&#39;ve applied a nifty little optimization to our rendering code. Since the drawing is happening each time the game loop runs, it will significantly affect performance the larger our drawing screen gets. So to minimize this, we&#39;ll only give our drawing method a specific list of tiles to re-draw, these tiles are the ones that have changed since the last time the game loop has ran, this way we avoid redrawing everything every single time, which saves us resources and makes the game run much faster.</p><p>You can go ahead and add this code right after your <strong>initialize</strong> method.</p><p></p><h3><a name='header-c165' class='md-header-anchor '></a><strong>First frame</strong></h3><p>Since we initialized our screen with random tiles, and since we have an optimized rendering algorithm, we need to render the entire screen the first time the game runs, because everything everything is new in this case. so we&#39;ll go ahead and add the following code to our <strong>Sand</strong> class constructor:</p><p></p><pre class="md-fences md-end-block" lang="javascript"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * Implements a physics based drawing game.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @class</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @namespace</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @this {Sand}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-def">Sand</span>() {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">getElementById</span>( <span class="cm-string">"screen"</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">canvasContext</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span>.<span class="cm-property">getContext</span>( <span class="cm-string">"2d"</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">horizontalTileCount</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span>.<span class="cm-property">width</span> <span class="cm-operator">/</span> <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">verticalTileCount</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span>.<span class="cm-property">height</span> <span class="cm-operator">/</span> <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">tiles</span> <span class="cm-operator">=</span> [];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; <span class="cm-keyword">this</span>.<span class="cm-property">isDrawing</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>; <span class="cm-comment">/* Flag: To check if we're currently drawing with the mouse. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; <span class="cm-keyword">this</span>.<span class="cm-property">currentTileType</span> <span class="cm-operator">=</span> <span class="cm-string">"s"</span>; <span class="cm-comment">/* Current drawing tile type. Black static tile by default. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">initialize</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; <span class="cm-keyword">var</span> <span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-variable">L</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">horizontalTileCount</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; &nbsp; &nbsp; <span class="cm-variable">y</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-variable">M</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">verticalTileCount</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; &nbsp; &nbsp; <span class="cm-variable">tiles</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">tiles</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; &nbsp; &nbsp; <span class="cm-variable">tilesToRedraw</span> <span class="cm-operator">=</span> [];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; <span class="cm-keyword">for</span>( ; <span class="cm-variable">x</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">L</span>; <span class="cm-variable">x</span><span class="cm-operator">++</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; &nbsp; &nbsp; <span class="cm-keyword">for</span>( <span class="cm-variable">y</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">y</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">M</span>; <span class="cm-variable">y</span><span class="cm-operator">++</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">tilesToRedraw</span>.<span class="cm-property">push</span>(</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { <span class="cm-property">x</span>: <span class="cm-variable">x</span>, <span class="cm-property">y</span>: <span class="cm-variable">y</span>, <span class="cm-property">value</span>: <span class="cm-variable">tiles</span>[ <span class="cm-variable">x</span> ][ <span class="cm-variable">y</span> ] }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; <span class="cm-keyword">this</span>.<span class="cm-variable">drawScreen</span>( <span class="cm-variable">tilesToRedraw</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 874px;"></div></div></div></pre><p></p><p>Go ahead and refresh your game page now, you should now see some results at last!</p><p> <img src='ui-2.png' alt='ui-2' /></p><p></p><p>As you can see, the <strong>initialize</strong> method did its job!</p><p></p><h3><a name='header-c183' class='md-header-anchor '></a><strong>Main Game Loop</strong></h3><p>Let&#39;s go ahead and write our main game loop, which will be in the form of a method named <strong>render</strong>. This method will run continuously and will execute all the logic and drawing code.</p><p>Instead of using a traditional loop, and to maximize frame rate performance we will be using the HTML5 <strong>requestAnimationFrame</strong> API, this method allows our logic and rendering to run before the browser paints the next frame, which will make our animations run much smoother, and save resources when we&#39;re not focused on the game browser tab, since it gets paused in that case. You can learn more about this feature here: <a href='https://css-tricks.com/using-requestanimationframe/' target='_blank' >https://css-tricks.com/using-requestanimationframe/</a></p><p></p><p>Go ahead and this code right after your <strong>drawScreen</strong> method</p><pre class="md-fences md-end-block" lang="javascript"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * Start the rendering game loop.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * This handles all the game physics</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @name render</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @function</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @memberof Sand</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @returns {void}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Sand</span>.<span class="cm-property">prototype</span>.<span class="cm-property">render</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">tilesToRedraw</span> <span class="cm-operator">=</span> [];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* Redraw the changed tiles. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">drawScreen</span>( <span class="cm-variable-2">tilesToRedraw</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* Execute the render function at next browser frame redraw. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">requestAnimationFrame</span>( <span class="cm-keyword">this</span>.<span class="cm-property">render</span>.<span class="cm-property">bind</span>( <span class="cm-keyword">this</span> ) );</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 391px;"></div></div></div></pre><p></p><p>And then call it after you instantiate your class, so that the game loop can start to run.</p><pre class="md-fences md-end-block" lang="javascript"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">var</span>  <span class="cm-def">game</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Sand</span>();</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; <span class="cm-variable">game</span>.<span class="cm-property">render</span>(); <span class="cm-comment">/* Start the game! */</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p></p><h3><a name='header-c200' class='md-header-anchor '></a><strong>Physics Effects</strong></h3><p>As explained in the beginning, our tiles will simulate gravity behavior that depends on their specific nature, whether it is water, air or land/stone.</p><p>We&#39;ll create a new method called <strong>applyPhysics</strong> which will loop through all tiles in our screen and apply a specific gravity behavior when it finds the required conditions for it to behave in such way. for instance if a land/stone tile is above a water tile, then the land/stone tile should switch places with as if it was faling through it, hence simulating gravity, we can apply the same logic for water/air and land/water situations.</p><p></p><p>We will also add one last behaviour specific to the water tiles. Since water is not solid, it moves if doesn&#39;t find a stable container where it can reach equilibrium. So to simulate this, we&#39;ll look for water tiles that have air tile neihbours and simply switch places with them. We&#39;ll also flip a coin to decide the direction our water tile will go.</p><p>This little trick will allows us to achieve a &quot;liquid&quot; effect, though not a 100% simulation, but it is close enough to pass.</p><p></p><p>Once this method finishes running, it will return the list of tiles that were affected, so that we can re-draw them as explained earlier.</p><p></p><p>You can go ahead and add the following code right below your <strong>drawScreen</strong> method:</p><pre class="md-fences md-end-block" lang="javascript"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * Applie gravity effect on each type of tile.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * This affects tiles of nature: water, air and land.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @name applyPhysics</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @function</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @memberof Sand</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @returns {void}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Sand</span>.<span class="cm-property">prototype</span>.<span class="cm-property">applyPhysics</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">x</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-def">L</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">horizontalTileCount</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-def">y</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-def">M</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">verticalTileCount</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-def">tiles</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">tiles</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-def">tile</span>, <span class="cm-def">tileBelow</span>, <span class="cm-def">tileBefore</span>, <span class="cm-def">tileBelowBefore</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-def">tilesToRedraw</span> <span class="cm-operator">=</span> [],</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-def">changeOccurred</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">for</span>( ; <span class="cm-variable-2">x</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">L</span>; <span class="cm-variable-2">x</span><span class="cm-operator">++</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">for</span>( <span class="cm-variable-2">y</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">y</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">M</span>; <span class="cm-variable-2">y</span><span class="cm-operator">++</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">tile</span> <span class="cm-operator">=</span> <span class="cm-variable-2">tiles</span>[ <span class="cm-variable-2">x</span> ][ <span class="cm-variable-2">y</span> ];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">tileBelow</span> <span class="cm-operator">=</span> <span class="cm-variable-2">tiles</span>[ <span class="cm-variable-2">x</span> ][ <span class="cm-variable-2">y</span> <span class="cm-operator">+</span> <span class="cm-number">1</span> ];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">changeOccurred</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable-2">y</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">M</span> <span class="cm-operator">-</span> <span class="cm-number">1</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">/* Land tiles go down if there is water or air below them */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable-2">tile</span> <span class="cm-operator">===</span> <span class="cm-variable">TILE_LAND</span> <span class="cm-operator">&amp;&amp;</span> ( <span class="cm-variable-2">tileBelow</span> <span class="cm-operator">===</span> <span class="cm-variable">TILE_AIR</span> <span class="cm-operator">||</span> <span class="cm-variable-2">tileBelow</span> <span class="cm-operator">===</span> <span class="cm-variable">TILE_WATER</span> ) ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">changeOccurred</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable-2">tile</span> <span class="cm-operator">===</span> <span class="cm-variable">TILE_WATER</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">tileBelow</span> <span class="cm-operator">===</span> <span class="cm-variable">TILE_AIR</span> ) { <span class="cm-comment">/* Water tiles go down if there is air below them. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">changeOccurred</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">/* Mark these tiles as changed, to avoid checking them again in the loop. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable-2">changeOccurred</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">tilesToRedraw</span>.<span class="cm-property">push</span>(</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-property">x</span>: <span class="cm-variable-2">x</span>, <span class="cm-property">y</span>: <span class="cm-variable-2">y</span>, <span class="cm-property">value</span>: <span class="cm-variable-2">tileBelow</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-property">x</span>: <span class="cm-variable-2">x</span>, <span class="cm-property">y</span>: <span class="cm-variable-2">y</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>, <span class="cm-property">value</span>: <span class="cm-variable-2">tile</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">tiles</span>[ <span class="cm-variable-2">x</span> ][ <span class="cm-variable-2">y</span> ] <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">tiles</span>[ <span class="cm-variable-2">x</span> ][ <span class="cm-variable-2">y</span> <span class="cm-operator">+</span> <span class="cm-number">1</span> ] <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">changeOccurred</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">/* Do a coin flip and decide which direction to move water tiles, to simulate water behaviour. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable-2">x</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">tileBefore</span> <span class="cm-operator">=</span> <span class="cm-variable-2">tiles</span>[ <span class="cm-variable-2">x</span> <span class="cm-operator">-</span> <span class="cm-number">1</span> ][ <span class="cm-variable-2">y</span> ];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">tileBelowBefore</span> <span class="cm-operator">=</span> <span class="cm-variable-2">tiles</span>[ <span class="cm-variable-2">x</span> <span class="cm-operator">-</span> <span class="cm-number">1</span> ][ <span class="cm-variable-2">y</span> <span class="cm-operator">+</span> <span class="cm-number">1</span> ];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">cointFlip</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">floor</span>( <span class="cm-variable">Math</span>.<span class="cm-property">random</span>() <span class="cm-operator">*</span> <span class="cm-number">2</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable-2">cointFlip</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">tile</span> <span class="cm-operator">===</span> <span class="cm-variable">TILE_WATER</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">tileBefore</span> <span class="cm-operator">==</span> <span class="cm-variable">TILE_AIR</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">tileBelow</span> <span class="cm-operator">!==</span> <span class="cm-variable">TILE_AIR</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">changeOccurred</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable-2">cointFlip</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">tile</span> <span class="cm-operator">===</span> <span class="cm-variable">TILE_AIR</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">tileBefore</span> <span class="cm-operator">===</span> <span class="cm-variable">TILE_WATER</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">tileBelowBefore</span> <span class="cm-operator">!==</span> <span class="cm-variable">TILE_AIR</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">changeOccurred</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">/* Mark these tiles as changed, to avoid checking them again in the loop. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable-2">changeOccurred</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">tilesToRedraw</span>.<span class="cm-property">push</span>(</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-property">x</span>: <span class="cm-variable-2">x</span>, <span class="cm-property">y</span>: <span class="cm-variable-2">y</span>, <span class="cm-property">value</span>: <span class="cm-variable-2">tileBefore</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-property">x</span>: <span class="cm-variable-2">x</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>, <span class="cm-property">y</span>: <span class="cm-variable-2">y</span>, <span class="cm-property">value</span>: <span class="cm-variable-2">tile</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">tiles</span>[ <span class="cm-variable-2">x</span> ][ <span class="cm-variable-2">y</span> ] <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">tiles</span>[ <span class="cm-variable-2">x</span> <span class="cm-operator">-</span> <span class="cm-number">1</span> ][ <span class="cm-variable-2">y</span> ] <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> <span class="cm-variable-2">tilesToRedraw</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1794px;"></div></div></div></pre><p></p><p>And then call it in your <strong>render</strong> method:</p><p></p><pre class="md-fences md-end-block" lang="javascript"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Sand</span>.<span class="cm-property">prototype</span>.<span class="cm-property">render</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {</span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; <span class="cm-keyword">var</span> <span class="cm-variable">tilesToRedraw</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">applyPhysics</span>(); <span class="cm-comment">/* We replaced the previous line with a call to the physics method. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; <span class="cm-comment">/* Redraw the changed tiles. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; <span class="cm-keyword">this</span>.<span class="cm-property">drawScreen</span>( <span class="cm-variable">tilesToRedraw</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* Execute the render function at next browser frame redraw. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">requestAnimationFrame</span>( <span class="cm-keyword">this</span>.<span class="cm-property">render</span>.<span class="cm-property">bind</span>( <span class="cm-keyword">this</span> ) );</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><p></p><p>Refresh your page and check the results, you&#39;ve got animation now! As you can see blue tiles behave like water, green tiles behave like land/stone, pretty cool!</p><p></p><h3><a name='header-c233' class='md-header-anchor '></a><strong>User Input</strong></h3><p>We&#39;re almost done with our game, all that is left now is to add our user input handling logic, since our game runs on the web, we can simple use the good old event listeners and set up callbacks to apply the changes.</p><p><strong>Mouse events:</strong></p><ul><li><strong>Mouse Down:</strong> The user left clicked the mouse and hasn&#39;t released it yet,  we can tell the game engine that the user is attempting to draw.</li><li><strong>Mouse Up:</strong> The user has released the left click of the mouse, we can tell the game engine that the user stopped drawing.</li><li><strong>Mouse Move:</strong> So that we can tell where to draw our tiles within our canvas.</li></ul><p><strong>Keyboard events:</strong></p><ul><li><strong>Alphanumeric</strong>: Using the <strong>TILE_COLORS</strong> variable that we defined earlier, we can decide what type of tile to draw.</li><li><strong>Escape Key:</strong> Which will make the game engine clear the drawing screen entirely.</li></ul><p>We&#39;ll go ahead and create a new method called <strong>setupEvents</strong></p><p>You can add this code right below your <strong>initialize</strong> method:</p><p></p><pre class="md-fences md-end-block" lang="javascript"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * Setup keyboard and mouse events*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * - Keyboard: To change tile type and to reset the screen</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * - Mouse: To draw tiles.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @name setupEvents</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @function</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @memberof Sand</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @returns {void}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Sand</span>.<span class="cm-property">prototype</span>.<span class="cm-property">setupEvents</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">screenCanvas</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable-2">screenCanvas</span>.<span class="cm-property">addEventListener</span>( <span class="cm-string">"mousedown"</span>, <span class="cm-keyword">this</span>.<span class="cm-property">startDrawing</span>.<span class="cm-property">bind</span>( <span class="cm-keyword">this</span> ) );  <span class="cm-comment">//The state of clicking mouse.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">document</span>.<span class="cm-property">addEventListener</span>( <span class="cm-string">"mouseup"</span>, <span class="cm-keyword">this</span>.<span class="cm-property">stopDrawing</span>.<span class="cm-property">bind</span>( <span class="cm-keyword">this</span> ) );  <span class="cm-comment">//The state of mousebutton1 is up.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">document</span>.<span class="cm-property">addEventListener</span>( <span class="cm-string">"mousemove"</span>, <span class="cm-keyword">this</span>.<span class="cm-property">processDrawing</span>.<span class="cm-property">bind</span>( <span class="cm-keyword">this</span> ) );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">document</span>.<span class="cm-property">addEventListener</span>( <span class="cm-string">"keypress"</span>, <span class="cm-keyword">this</span>.<span class="cm-property">updateCurrentTileType</span>.<span class="cm-property">bind</span>( <span class="cm-keyword">this</span> ) );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">document</span>.<span class="cm-property">addEventListener</span>( <span class="cm-string">"keyup"</span>, <span class="cm-keyword">this</span>.<span class="cm-property">clearScreen</span>.<span class="cm-property">bind</span>( <span class="cm-keyword">this</span> ) );</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 483px;"></div></div></div></pre><p>All we&#39;ve done is ask the browser to execute those callbacks every time an event is detected.</p><p><strong>Note:</strong> We use the bind method to tell the browser to execute the callbacks with the right <strong>this</strong> context, you can learn more about this here: <a href='https://www.smashingmagazine.com/2014/01/understanding-javascript-function-prototype-bind/' target='_blank' >https://www.smashingmagazine.com/2014/01/understanding-javascript-function-prototype-bind/</a></p><p></p><p>Let&#39;s add our input handling methods now, you can add this right below your <strong>setupEvents</strong> method:</p><p></p><pre class="md-fences md-end-block" lang="javascript"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * Enables drawing when the mouse moves</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * This gets executed when we hold the left mouse button down.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @name startDrawing</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @function</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @memberof Sand</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param {Object} event DOM event object.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @returns {void}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Sand</span>.<span class="cm-property">prototype</span>.<span class="cm-property">startDrawing</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>( <span class="cm-def">event</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">isDrawing</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">processDrawing</span>( <span class="cm-variable-2">event</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * Disable drawing when the mouse moves</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * This gets executed when we release the left mouse button.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @name stopDrawing</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @function</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @memberof Sand</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param {Object} event DOM event object.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @returns {void}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Sand</span>.<span class="cm-property">prototype</span>.<span class="cm-property">stopDrawing</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>( <span class="cm-def">event</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">isDrawing</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * Changes the tile type that we're currently drawing</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * This gets executed when we press the relevant keyboard keys.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @name updateCurrentTileType</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @function</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @memberof Sand</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param {Object} event DOM event object.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @returns {void}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Sand</span>.<span class="cm-property">prototype</span>.<span class="cm-property">updateCurrentTileType</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>( <span class="cm-def">event</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">TILE_COLORS</span>[ <span class="cm-variable-2">event</span>.<span class="cm-property">key</span> ] )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">return</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">currentTileType</span> <span class="cm-operator">=</span> <span class="cm-variable-2">event</span>.<span class="cm-property">key</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * Draws the tile at the current mouse position</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * This gets executed when we move the mouse and when drawing mode is on.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @name processDrawing</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @function</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @memberof Sand</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param {Object} event DOM event object.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @returns {void}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Sand</span>.<span class="cm-property">prototype</span>.<span class="cm-property">processDrawing</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>( <span class="cm-def">event</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-keyword">this</span>.<span class="cm-property">isDrawing</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">return</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">targetTile</span> <span class="cm-operator">=</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-property">x</span>: <span class="cm-variable">Math</span>.<span class="cm-property">floor</span>( ( <span class="cm-variable-2">event</span>.<span class="cm-property">pageX</span> <span class="cm-operator">-</span> <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span>.<span class="cm-property">offsetLeft</span> ) <span class="cm-operator">/</span> <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span> ),</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-property">y</span>: <span class="cm-variable">Math</span>.<span class="cm-property">floor</span>( ( <span class="cm-variable-2">event</span>.<span class="cm-property">pageY</span> <span class="cm-operator">-</span> <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span>.<span class="cm-property">offsetTop</span> ) <span class="cm-operator">/</span> <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  };</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/**</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * If we're currently drawing and the mouse is on top of a tile, we redraw it.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; * We basically check if the mouse is inside the screen boundaries.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> &nbsp; &nbsp; */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable-2">targetTile</span>.<span class="cm-property">x</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">0</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">targetTile</span>.<span class="cm-property">x</span> <span class="cm-operator">&lt;</span> <span class="cm-keyword">this</span>.<span class="cm-property">horizontalTileCount</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">targetTile</span>.<span class="cm-property">y</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">0</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">targetTile</span>.<span class="cm-property">y</span> <span class="cm-operator">&lt;</span> <span class="cm-keyword">this</span>.<span class="cm-property">verticalTileCount</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">drawScreen</span>( [{</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-property">x</span>: <span class="cm-variable-2">targetTile</span>.<span class="cm-property">x</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-property">y</span>: <span class="cm-variable-2">targetTile</span>.<span class="cm-property">y</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-property">value</span>: <span class="cm-keyword">this</span>.<span class="cm-property">currentTileType</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }]);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  } &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * Replaces all tiles with air tiles.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * This gets executed when we press the Escape keY&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @name clearScreen</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @function</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @memberof Sand</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @param {Object} event DOM event object.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> * @returns {void}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"> */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Sand</span>.<span class="cm-property">prototype</span>.<span class="cm-property">clearScreen</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>( <span class="cm-def">event</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable-2">event</span>.<span class="cm-property">keyCode</span> <span class="cm-operator">!==</span> <span class="cm-number">27</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">return</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">x</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-def">L</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">horizontalTileCount</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-def">y</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-def">M</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">verticalTileCount</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-def">tiles</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">tiles</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-def">tilesToRedraw</span> <span class="cm-operator">=</span> [];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">for</span>( ; <span class="cm-variable-2">x</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">L</span>; <span class="cm-variable-2">x</span><span class="cm-operator">++</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">for</span>( <span class="cm-variable-2">y</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">y</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">M</span>; <span class="cm-variable-2">y</span><span class="cm-operator">++</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">tiles</span>[ <span class="cm-variable-2">x</span> ][ <span class="cm-variable-2">y</span> ] <span class="cm-operator">=</span> <span class="cm-variable">TILE_AIR</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">tilesToRedraw</span>.<span class="cm-property">push</span>(</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-property">x</span>: <span class="cm-variable-2">x</span>, <span class="cm-property">y</span>: <span class="cm-variable-2">y</span>, <span class="cm-property">value</span>: <span class="cm-variable">TILE_AIR</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">drawScreen</span>( <span class="cm-variable-2">tilesToRedraw</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2438px;"></div></div></div></pre><p></p><p>The code is quite simple and straight forward, just read the accompanying comments and it should be easy to understand.</p><p></p><p>The moment of truth, all we have to do now, is call our <strong>setupEvents</strong> method within our <strong>Sand</strong> class constructor:</p><p></p><pre class="md-fences md-end-block" lang="javascript"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-def">Sand</span>() {</span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">getElementById</span>( <span class="cm-string">"screen"</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">canvasContext</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span>.<span class="cm-property">getContext</span>( <span class="cm-string">"2d"</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">horizontalTileCount</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span>.<span class="cm-property">width</span> <span class="cm-operator">/</span> <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">verticalTileCount</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">screenCanvas</span>.<span class="cm-property">height</span> <span class="cm-operator">/</span> <span class="cm-keyword">this</span>.<span class="cm-property">tileSize</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">tiles</span> <span class="cm-operator">=</span> [];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">isDrawing</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>; <span class="cm-comment">/* Flag: To check if we're currently drawing with the mouse. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">currentTileType</span> <span class="cm-operator">=</span> <span class="cm-string">"s"</span>; <span class="cm-comment">/* Current drawing tile type. Black static tile by default. */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">initialize</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> &nbsp; <span class="cm-keyword">this</span>.<span class="cm-property">setupEvents</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">x</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-def">L</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">horizontalTileCount</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-def">y</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-def">M</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">verticalTileCount</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-def">tiles</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">tiles</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-def">tilesToRedraw</span> <span class="cm-operator">=</span> [];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">for</span>( ; <span class="cm-variable-2">x</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">L</span>; <span class="cm-variable-2">x</span><span class="cm-operator">++</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">for</span>( <span class="cm-variable-2">y</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">y</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">M</span>; <span class="cm-variable-2">y</span><span class="cm-operator">++</span> ) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-2">tilesToRedraw</span>.<span class="cm-property">push</span>(</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-property">x</span>: <span class="cm-variable-2">x</span>, <span class="cm-property">y</span>: <span class="cm-variable-2">y</span>, <span class="cm-property">value</span>: <span class="cm-variable-2">tiles</span>[ <span class="cm-variable-2">x</span> ][ <span class="cm-variable-2">y</span> ] }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">this</span>.<span class="cm-property">drawScreen</span>( <span class="cm-variable-2">tilesToRedraw</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 782px;"></div></div></div></pre><p></p><p>Go ahead and refresh your game now, you will be able to change the drawing type of your tile just by pressing the associated keys and draw whatever you like, just make sure to press <strong>Escape</strong> to get a clean drawing screen.</p></div>
</body>
</html>